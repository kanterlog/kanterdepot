<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dictée Animée - Zheng He</title>
  <style>
    body { font-family: 'Segoe UI', 'Arial', sans-serif; background: #e9f1f7; color: #223; margin: 0; padding: 0; }
    .container { max-width: 740px; margin: 30px auto; background: #fff; border-radius: 18px; box-shadow: 0 8px 32px #b2cbde42; padding: 40px 28px 32px 28px; }
    .title { font-size: 2.1em; margin-bottom: 10px; font-weight: 600; color: #23537a; letter-spacing: 1px; }
    .subtitle { font-size: 1.1em; color: #457; margin-bottom: 32px; }
    .dictation-text { margin: 30px 0 20px 0; font-size: 1.35em; background: #f0f7fb; padding: 25px; border-radius: 14px; box-shadow: 0 2px 8px #b2cbde13; min-height: 90px; line-height: 2.0; display: flex; flex-wrap: wrap; gap: 8px 4px; justify-content: center; }
    .word { transition: background .2s, color .2s, box-shadow .2s; padding: 4px 8px; border-radius: 7px; cursor: pointer; }
    .word.active { background: #f9cb77; color: #333; font-weight: 700; box-shadow: 0 0 0 2px #d9b364; animation: magicpop 0.4s; }
    @keyframes magicpop { 0% { transform: scale(1);} 30% { transform: scale(1.27);} 70% { transform: scale(0.95);} 100% { transform: scale(1);} }
    .audioplayer { display: flex; align-items: center; gap: 13px; margin: 22px 0; border-radius: 8px; background: #e4eefd; padding: 10px 14px; box-shadow: 0 2px 8px #b2cbde22; }
    .audioplayer label { font-size: 1.1em; color: #23537a; font-weight: 500; width: 168px; min-width: 100px; }
    audio { width: 250px; }
    .footer { margin-top: 35px; font-size: 0.99em; color: #888; text-align: center; }
    @media (max-width: 850px) { .container { max-width: 97vw; padding: 12vw 2vw; } .dictation-text { font-size: 1.05em; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">Dictée Animée – Zheng He</div>
    <div class="subtitle">
      <span style="color:#257d93;">Lecture animée mot à mot + relecture finale</span>
    </div>

    <div class="audioplayer">
      <label>Lecture animée (mot à mot)</label>
      <audio id="audio-animated" src="version lente.mp3" controls></audio>
    </div>

    <div class="audioplayer">
      <label>Lecture finale (fluide)</label>
      <audio id="audio-final" src="version normale de relecture (1).mp3" controls></audio>
    </div>

    <div id="dictation-text" class="dictation-text"></div>

    <div class="footer">
      <b>Astuce :</b> Si besoin, ajuste le timing dans <code>timedWords</code> pour caler au mieux la synchro sur tes MP3.<br>
      Réalisé par ChatGPT pour Nico – <a href="https://www.readbeyond.it/aeneas/">Timing via Aeneas</a>
    </div>
  </div>

  <script>
  // === Tableau timedWords complet ===
  const timedWords = [
    { word: "Zheng", start: 0.00 }, { word: "He", start: 1.04 }, { word: "est", start: 1.04 }, { word: "un", start: 1.16 }, { word: "grand", start: 1.64 },
    { word: "navigateur", start: 2.36 }, { word: "chinois", start: 3.08 }, { word: "du", start: 3.44 }, { word: "XVe", start: 3.56 }, { word: "siècle", start: 3.80 },
    { word: "Il", start: 4.12 }, { word: "est", start: 4.36 }, { word: "né", start: 4.56 }, { word: "dans", start: 4.72 }, { word: "les", start: 4.96 }, { word: "montagnes", start: 5.08 },
    { word: "du", start: 5.52 }, { word: "sud-ouest", start: 5.68 }, { word: "de", start: 6.16 }, { word: "la", start: 6.32 }, { word: "Chine", start: 6.44 }, { word: "actuelle", start: 6.80 },
    { word: "bien", start: 7.36 }, { word: "loin", start: 7.56 }, { word: "de", start: 7.68 }, { word: "la", start: 7.76 }, { word: "mer", start: 7.80 }, { word: "Mais", start: 8.24 },
    { word: "un", start: 8.52 }, { word: "événement", start: 8.68 }, { word: "tragique", start: 9.32 }, { word: "vient", start: 9.76 }, { word: "modifier", start: 10.12 },
    { word: "le", start: 10.56 }, { word: "cours", start: 10.64 }, { word: "de", start: 10.96 }, { word: "sa", start: 11.08 }, { word: "vie", start: 11.16 },
    { word: "À", start: 11.80 }, { word: "treize", start: 12.20 }, { word: "ans", start: 12.60 }, { word: "il", start: 12.92 }, { word: "est", start: 13.08 }, { word: "capturé", start: 13.20 },
    { word: "par", start: 13.72 }, { word: "l’armée", start: 13.96 }, { word: "impériale", start: 14.36 }, { word: "Il", start: 15.00 }, { word: "sera", start: 15.20 }, { word: "alors", start: 15.44 },
    { word: "forcé", start: 15.72 }, { word: "de", start: 16.24 }, { word: "servir", start: 16.32 }, { word: "l’empereur", start: 16.64 }, { word: "à", start: 16.92 }, { word: "la", start: 17.04 },
    { word: "cour", start: 17.08 }, { word: "Au", start: 17.64 }, { word: "fil", start: 17.84 }, { word: "du", start: 18.12 }, { word: "temps", start: 18.32 }, { word: "Zheng", start: 18.52 },
    { word: "He", start: 18.72 }, { word: "réussit", start: 18.88 }, { word: "à", start: 19.48 }, { word: "se", start: 19.64 }, { word: "distinguer", start: 19.80 }, { word: "et", start: 20.60 },
    { word: "à", start: 20.76 }, { word: "se", start: 20.84 }, { word: "faire", start: 20.96 }, { word: "remarquer", start: 21.24 }, { word: "par", start: 21.60 }, { word: "l’empereur", start: 21.80 },
    { word: "Il", start: 22.48 }, { word: "devient", start: 22.64 }, { word: "ainsi", start: 22.96 }, { word: "son", start: 23.20 }, { word: "plus", start: 23.40 }, { word: "fidèle", start: 23.60 },
    { word: "conseiller", start: 23.92 }, { word: "Vers", start: 24.44 }, { word: "1405", start: 24.76 }, { word: "l’empereur", start: 25.04 }, { word: "confie", start: 25.24 },
    { word: "à", start: 25.56 }, { word: "Zheng", start: 25.64 }, { word: "He", start: 25.76 }, { word: "une", start: 25.96 }, { word: "flotte", start: 26.28 }, { word: "gigantesque", start: 26.68 },
    { word: "qui", start: 27.04 }, { word: "compte", start: 27.16 }, { word: "deux-cent-cinquante-cinq", start: 27.40 }, { word: "navires", start: 27.96 }, { word: "Zheng", start: 28.36 },
    { word: "He", start: 28.48 }, { word: "explore", start: 28.56 }, { word: "alors", start: 28.88 }, { word: "les", start: 29.04 }, { word: "îles", start: 29.20 }, { word: "de", start: 29.44 },
    { word: "l’océan", start: 29.52 }, { word: "Indien", start: 29.80 }, { word: "puis", start: 30.24 }, { word: "se", start: 30.32 }, { word: "rend", start: 30.48 }, { word: "en", start: 30.68 },
    { word: "Égypte", start: 31.20 }
  ];

  // ======= Affichage et synchronisation mot à mot =======
  const dictationContainer = document.getElementById("dictation-text");
  timedWords.forEach((item, i) => {
    const w = document.createElement("span");
    w.textContent = item.word;
    w.classList.add("word");
    w.id = "word-" + i;
    dictationContainer.appendChild(w);
  });

  let currentIndex = -1;
  let isPlaying = false;
  const audio = document.getElementById("audio-animated");

  function highlightWord(index) {
    if (currentIndex >= 0) document.getElementById("word-" + currentIndex).classList.remove("active");
    if (index >= 0 && index < timedWords.length) document.getElementById("word-" + index).classList.add("active");
    currentIndex = index;
  }

  function updateWordHighlight() {
    if (!isPlaying) return;
    const currentTime = audio.currentTime;
    let idx = timedWords.length - 1;
    for (let i = 0; i < timedWords.length; i++) {
      if (timedWords[i].start > currentTime) {
        idx = i - 1;
        break;
      }
    }
    if (idx !== currentIndex) highlightWord(idx);
  }

  audio.addEventListener("play", () => { isPlaying = true; });
  audio.addEventListener("pause", () => { isPlaying = false; });
  audio.addEventListener("timeupdate", updateWordHighlight);
  audio.addEventListener("seeked", updateWordHighlight);
  audio.addEventListener("ended", () => { highlightWord(-1); isPlaying = false; });
  audio.addEventListener("pause", () => { if (audio.currentTime === 0) highlightWord(-1); });

  highlightWord(-1);
  </script>
</body>
</html>
